# OASIS Progress Report — February 20, 2026

## Overview

This document reviews all features implemented in the OASIS civilization simulation game as of the date above, organized by the development phases defined in `PROJECT_ARCHITECTURE.md`.

---

## Phase 0: Skeleton Deploy — COMPLETE

- [x] Create Next.js project with TypeScript and Tailwind
- [x] Connect to Supabase (project created, env vars configured)
- [x] Deploy to Vercel from GitHub
- [x] Blank page loads at public URL with working DB read
- [ ] GitHub Actions keep-alive cron for Supabase *(script `scripts/keep-alive.ts` referenced in project structure but not yet created)*

**Commits:** `108b358` Phase 0: scaffold Next.js + Supabase skeleton

---

## Phase 1: Foundation Engine — COMPLETE

- [x] Core types (`src/engine/types.ts`) — all game state interfaces, order types, discriminated unions
- [x] Theme package schema (`src/themes/schema.ts`) — comprehensive: civs, techs, buildings, units, events, map config, victory/defeat, mechanic modifiers
- [x] Map generator (`src/engine/map-generator.ts`) — anchor-constrained procedural hex grid with zone-based terrain
- [x] Turn resolution pipeline skeleton (`src/engine/turn-resolver.ts`)
- [x] Seeded PRNG utility (`src/engine/prng.ts`) — Mulberry32 with fork, weighted choice
- [x] Tests for engine functions (`src/engine/__tests__/prng.test.ts`, `map-generator.test.ts`)

**Commits:** `ea82590` Phase 1: Foundation Engine

---

## Phase 2: Al Rassan Theme — COMPLETE

- [x] Al Rassan theme package generated (`src/themes/al-rassan/theme.json`, ~26k lines)
- [x] 5 civilizations defined: Ragosa, Cartada, Valledo, Ruenda, Kindath (asymmetric starts)
- [x] Religious tension axis mechanic (tension axes in theme modifiers)
- [x] Event deck with triggers and consequences (turn-based, resource, stability, tension, tech, war triggers)
- [x] Tech/culture tree (crop-rotation, trade-networks, patronage-arts, levy-infantry, horsemanship, etc.)
- [x] Balanced starting positions and resources (5 capitals + 5 secondary settlements across 22x16 hex map)
- [x] Economy engine (`src/engine/economy.ts`) — production, upkeep, seasonal effects, resource interactions
- [x] Combat engine (`src/engine/combat.ts`) — deterministic d6-based, terrain/garrison bonuses, morale
- [x] Events engine (`src/engine/events.ts`) — trigger evaluation, effect application, player choice responses
- [x] Diplomacy engine (`src/engine/diplomacy.ts`) — symmetric relation updates, war cascades via alliances
- [x] AI governor (`src/engine/ai-governor.ts`) — minimal (research + granary heuristic only)
- [x] Full turn resolver (`src/engine/turn-resolver.ts`) — all 11 phases implemented
- [x] Tests for economy, combat, events, diplomacy, AI governor, turn resolver

**Commits:** `98be29b` Phase 2a, `f1f3f9d` Phase 2b, `184e059` Phase 2c

---

## Phase 3: Single Player Playable — MOSTLY COMPLETE

### Game UI
- [x] Hex map renderer (`src/components/map/HexMap.tsx`) — SVG pointy-top hexes, terrain colors, settlement markers (stars for capitals), unit dots, civ-colored borders, fog of war overlay, selected hex highlight, reachable destination overlay
- [x] Civilization dashboard (`src/components/game/CivDashboard.tsx`) — resources, stability bar, diplomatic relations matrix
- [x] Turn summary panel (`src/components/game/TurnSummaryPanel.tsx`) — narrative text, resource deltas, combat results
- [x] Orders panel with tabs (`src/components/game/OrdersPanel.tsx`) — Research, Build, Diplomacy, Events tabs
- [x] Research panel (`src/components/game/ResearchPanel.tsx`) — in-progress tech, available tech, prerequisite filtering, era badges
- [x] Build panel (`src/components/game/BuildPanel.tsx`) — per-settlement building selection, cost/upkeep display, tech prerequisite filtering
- [x] Diplomacy panel (`src/components/game/DiplomacyPanel.tsx`) — per-civ actions, relationship state, message sending
- [x] Events panel (`src/components/game/EventsPanel.tsx`) — active event display, choice selection, default marking
- [x] Turn panel (`src/components/game/TurnPanel.tsx`) — submit orders, resolve turn, submission count, 15s polling
- [x] Game view orchestrator (`src/components/game/GameView.tsx`) — integrates map, dashboard, orders, turn panel, unit selection/movement

### Supabase Wiring
- [x] Game creation flow (`src/app/create/page.tsx`)
- [x] Game state persistence (`useGameState` hook, 30s polling)
- [x] Turn submission (upsert to `turn_orders` table)
- [x] Turn resolution (loads all orders from DB, calls `resolveTurn()`, updates `games.game_state`)

### Turn Resolution
- [x] All 11 phases implemented with real game logic (diplomacy, orders, movement, combat, economy, construction, research, events, attrition, victory/defeat, summary)
- [x] Movement with pathfinding validation (`src/engine/pathfinding.ts` — BFS reachability)
- [x] Hex control transfer on unit occupation
- [x] Game initializer (`src/lib/game-initializer.ts`) — generates map, places starting units, initializes fog of war

### AI Governor
- [x] AI generates orders for non-submitted civs (`fillMissingOrdersWithAI`)
- [ ] AI does not move units, scout, or engage in combat (minimal heuristics only)
- [ ] No solo playtesting workflow — AI is passive, making solo play unengaging

### Known Issues
- [ ] `GameView.tsx` contains debug output markers (should be removed)
- [ ] `validateOrders()` in turn-resolver is a stub (passes orders through without validation)
- [ ] Research points allocation is hardcoded to 100 (no flexible resource allocation)

**Commits:** `8e79d19` Phase 3b, `4f2fe3d` Phase 3d, `03e416f`, `b7dda29`, `2ed8beb`

---

## Phase 4: Multiplayer — MOSTLY COMPLETE

- [x] Supabase Auth: email OTP / magic link sign-in (`src/app/auth/page.tsx`)
- [x] Auth callback handling for PKCE and implicit flows (`src/app/auth/callback/page.tsx`)
- [x] Auth state hook (`src/lib/hooks/useAuth.ts`)
- [x] Game lobby (`src/components/lobby/LobbyRoom.tsx`) — player list, invite link, start game button (creator only)
- [x] Invite system (`src/components/lobby/InvitePanel.tsx`) — shareable join URL with copy button
- [x] Join flow (`src/app/join/[id]/page.tsx`) — civ selection for invited players, lobby-phase gate
- [x] Civ selection for creator (`src/app/game/[id]/pick-civ/page.tsx`)
- [x] Game list / lobby home (`src/app/page.tsx`, `GameList`, `GameCard` components)
- [x] Multi-player turn submission (each player submits independently; TurnPanel tracks count)
- [x] Turn resolution triggers when all players have submitted
- [ ] Turn deadline / auto-resolve timer — not implemented (no `turn_deadline` enforcement)
- [ ] Diplomatic messaging between players — orders exist but no in-game message inbox/history UI
- [ ] Concurrent-resolution safety — no lock or guard against double-resolution race condition
- [ ] Player dropout handling — `is_active` flag exists in DB but no UI or logic to handle mid-game dropouts

**Commits:** `00a838b` Phase 3a (auth/lobby were built alongside Phase 3)

---

## Phase 5: Theme Abstraction — NOT STARTED

- [ ] Extract universal schema from Al Rassan implementation
- [ ] Create blank theme template (`src/themes/_template/theme.json` exists in project structure but not confirmed created)
- [ ] Generate a second theme to validate the schema
- [ ] Document theme creation process

---

## Database Schema — COMPLETE

- [x] `profiles` table (extends auth.users)
- [x] `games` table (metadata, game_state JSONB, phase)
- [x] `game_players` table (player-civ mapping, unique constraints)
- [x] `turn_orders` table (per-player orders per turn)
- [x] `turn_history` table (resolved summaries + optional state snapshots)
- [x] `invites` table (invite codes, claiming, expiration)
- [x] RLS policies on all tables (tested, infinite recursion bug fixed)
- [x] Indexes for performance on FK lookups

**Migrations:** `001_initial_schema.sql`, `002_join_policy.sql`

---

## Infrastructure & Tooling

- [x] Vitest test suite with coverage (`vitest`, `@vitest/coverage-v8`)
- [x] TypeScript strict mode
- [x] ESLint with Next.js config
- [x] Debug log protocol (`DEBUG_LOG.md` — 6 bugs documented and resolved)
- [ ] GitHub Actions keep-alive cron (not yet created)
- [ ] CI pipeline (no GitHub Actions for build/test on push)

---

## Summary by Phase

| Phase | Status | Remaining |
|-------|--------|-----------|
| Phase 0: Skeleton Deploy | **Complete** | Keep-alive cron missing |
| Phase 1: Foundation Engine | **Complete** | — |
| Phase 2: Al Rassan Theme | **Complete** | — |
| Phase 3: Single Player Playable | **~90%** | AI governor too passive; debug cleanup; order validation stub |
| Phase 4: Multiplayer | **~70%** | Turn deadlines, race condition guard, dropout handling, message history |
| Phase 5: Theme Abstraction | **Not started** | All items pending |

---

## Top Priority Items (Unfinished)

1. **Turn deadline auto-resolve** — Players need a deadline; currently turns wait forever for all submissions
2. **Concurrent-resolution guard** — Prevent two players from resolving the same turn simultaneously
3. **AI governor improvements** — AI needs unit movement and basic combat to make solo play viable
4. **Diplomatic message history** — Players can send messages but there's no inbox to read them
5. **Player dropout handling** — Mark inactive players, let AI take over
6. **Order validation** — `validateOrders()` is a stub; invalid orders pass through unchecked
7. **Remove debug output** — `GameView.tsx` has debug markers that should be cleaned up
8. **Keep-alive cron** — Prevent Supabase free tier from pausing
9. **Theme template** — Create blank template for Phase 5
10. **Second theme** — Validate the schema generalizes beyond Al Rassan
